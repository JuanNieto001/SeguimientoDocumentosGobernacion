# FLUJO REAL CD-PN - 9 ETAPAS (0-8)

## ‚ö†Ô∏è CORRECCI√ìN IMPORTANTE
El sistema ten√≠a 16 etapas (0-15) pero el flujo REAL de la Gobernaci√≥n tiene **9 ETAPAS (0-8)**

---

## üìä ETAPAS CORRECTAS

### **ETAPA 0 - Definici√≥n de la Necesidad**
- **Responsable:** Unidad Solicitante (Jefe de Unidad)
- **Rol:** `unidad_solicitante`
- **Documentos:**
  1. ‚úÖ **Estudios Previos** (objeto, valor, plazo) - √öNICO DOCUMENTO
- **Env√≠a a:** Descentralizaci√≥n (Planeaci√≥n)

---

### **ETAPA 1 - Solicitud de Documentos Iniciales** üîÑ PARALELO
- **Responsable:** Unidad de Descentralizaci√≥n
- **Rol:** `planeacion`
- **Documentos (pueden solicitarse simult√°neamente):**
  1. PAA ‚Üí Compras (Sec. General)
  2. No Planta ‚Üí Talento Humano (Sec. General)
  3. Paz y Salvo Rentas ‚Üí Hacienda
  4. Paz y Salvo Contabilidad ‚Üí Hacienda
  5. **Compatibilidad del Gasto** ‚Üí Planeaci√≥n ‚ö†Ô∏è REQUERIDO PRIMERO
  6. **CDP** ‚Üí Hacienda ‚ö†Ô∏è REQUIERE Compatibilidad
  7. SIGEP validado ‚Üí Jur√≠dica
- **Env√≠a a:** Unidad Solicitante

---

### **ETAPA 2 - Validaci√≥n del Contratista** üîÑ PARALELO
- **Responsable:** Abogado Unidad Solicitante
- **Rol:** `unidad_solicitante`
- **Documentos del contratista (21):**
  - Hoja de vida SIGEP
  - Certificados estudio y experiencia
  - RUT, c√©dula, cuenta bancaria
  - Antecedentes (disciplinarios, fiscales, judiciales, delitos sexuales)
  - Seguridad social (salud, pensi√≥n)
  - Certificado m√©dico
  - Tarjeta profesional (si aplica)
  - REDAM, inhabilidades
- **Env√≠a a:** Abogado Unidad (Etapa 3)

---

### **ETAPA 3 - Elaboraci√≥n de Documentos Contractuales**
- **Responsable:** Abogado Unidad Solicitante
- **Rol:** `unidad_solicitante`
- **Documentos proyectados (8):**
  1. Invitaci√≥n a Presentar Oferta (firma ordenador + supervisor)
  2. Solicitud de Contrataci√≥n y Supervisi√≥n (firma ordenador + supervisor)
  3. Certificado de Idoneidad (firma ordenador)
  4. Estudios Previos definitivos (firma ordenador + supervisor)
  5. An√°lisis del Sector (firma supervisor)
  6. Aceptaci√≥n de Oferta (firma contratista)
  7. Ficha BPIN (opcional)
  8. Excepci√≥n regla fiscal (opcional)
- **Env√≠a a:** Abogado Unidad (Etapa 4)

---

### **ETAPA 4 - Consolidaci√≥n del Expediente Precontractual**
- **Responsable:** Abogado Unidad Solicitante
- **Rol:** `unidad_solicitante`
- **Actividad:** Organizar carpeta completa con **35 documentos** (checklist)
- **Nota:** La carpeta debe llevar el nombre del contratista
- **Env√≠a a:** Secretar√≠a Jur√≠dica

---

### **ETAPA 5 - Radicaci√≥n en Secretar√≠a Jur√≠dica + Ajustado a Derecho**
- **Responsable:** Oficina de Radicaci√≥n + Abogado Enlace
- **Rol:** `juridica`
- **Actividades:**
  1. Solicitud en SharePoint
  2. Asignar n√∫mero proceso (CD-SP-XX-2026)
  3. Revisi√≥n lista de chequeo
  4. Ajustado a Derecho (si hay observaciones ‚Üí devuelve)
  5. **Firma contrato:** Secretario Privado + Contratista + Abogado Enlace
- **Env√≠a a:** SECOP

---

### **ETAPA 6 - Publicaci√≥n y Firma en SECOP II**
- **Responsable:** Apoyo Estructuraci√≥n
- **Rol:** `secop`
- **Actividades:**
  1. Cargar contrato en SECOP II
  2. Flujo aprobaci√≥n:
     - Abogado enlace aprueba creaci√≥n
     - **Contratista firma PRIMERO**
     - **Secretario Privado firma DESPU√âS**
  3. Descargar contrato electr√≥nico
- **Env√≠a a:** Descentralizaci√≥n (Planeaci√≥n)

---

### **ETAPA 7 - Solicitud de RPC (Registro Presupuestal)**
- **Responsable:** Unidad de Descentralizaci√≥n
- **Rol:** `planeacion`
- **Actividades:**
  1. Imprimir contrato + ajustado a derecho
  2. Solicitud RPC firmada por Secretario de Planeaci√≥n
  3. Radicar en Hacienda
  4. **Hacienda expide RPC** (Unidad de Presupuesto)
  5. **Paralelo:** Organizar expediente f√≠sico completo
- **Env√≠a a:** Secretar√≠a Jur√≠dica

---

### **ETAPA 8 - Radicaci√≥n Final y N√∫mero de Contrato**
- **Responsable:** Oficina de Radicaci√≥n
- **Rol:** `juridica`
- **Actividades:**
  1. Con RPC listo ‚Üí radicar expediente
  2. Asignar n√∫mero de contrato
- **Env√≠a a:** Unidad Solicitante (Etapa 9)

---

### **ETAPA 9 - ARL, Acta de Inicio e Inicio en SECOP** ‚úÖ FINAL
- **Responsable:** Supervisor + Contratista
- **Rol:** `unidad_solicitante`
- **Actividades:**
  1. Solicitud ARL con n√∫mero de contrato
  2. Elaboraci√≥n Acta de Inicio
  3. Firma por partes
  4. Registro inicio ejecuci√≥n en SECOP II
- **Estado:** ‚úÖ **CONTRATO INICIADO**

---

## üìÅ TIPOS DE DOCUMENTOS POR ETAPA

| Etapa | Tipos Permitidos |
|-------|------------------|
| 0 | `estudios_previos` (√öNICO) |
| 1 | `paa`, `no_planta`, `paz_salvo_rentas`, `paz_salvo_contabilidad`, `compatibilidad_gasto`, `cdp`, `sigep` |
| 2 | `hoja_vida_sigep`, `certificado_estudio`, `certificado_experiencia`, `rut`, `cedula`, `cuenta_bancaria`, `antecedentes_*`, `seguridad_social_*`, `certificado_medico`, `tarjeta_profesional`, `redam` |
| 3 | `invitacion_oferta`, `solicitud_contratacion`, `certificado_idoneidad`, `estudios_previos_finales`, `analisis_sector`, `aceptacion_oferta`, `ficha_bpin`, `excepcion_fiscal` |
| 4 | `carpeta_precontractual` (checklist 35 docs) |
| 5 | `solicitud_sharepoint`, `numero_proceso`, `lista_chequeo`, `ajustado_derecho`, `contrato_firmado` |
| 6 | `contrato_secop`, `aprobacion_juridica`, `firma_contratista`, `firma_secretario`, `contrato_electronico` |
| 7 | `solicitud_rpc`, `firma_secretario_planeacion`, `radicado_hacienda`, `rpc_expedido`, `expediente_fisico` |
| 8 | `radicado_final`, `numero_contrato` |
| 9 | `solicitud_arl`, `acta_inicio`, `registro_secop_inicio` |

---

## ‚ö†Ô∏è REGLAS CR√çTICAS

1. **Etapa 0:** SOLO "Estudios Previos" - nada m√°s
2. **Etapa 1:** CDP requiere Compatibilidad del Gasto primero
3. **Etapa 5:** Contrato firmado por 3 personas (Privado, Contratista, Jur√≠dica)
4. **Etapa 6:** Contratista firma ANTES que Secretario Privado
5. **Etapa 7:** RPC es PRERREQUISITO para Etapa 8
6. **Etapa 8:** N√∫mero de contrato es PRERREQUISITO para Etapa 9

---

## üîß CORRECCIONES NECESARIAS

### ‚úÖ 1. WorkflowSeeder.php
- [ ] Reducir de 16 etapas a 9 etapas (0-8)
- [ ] Ajustar descripciones seg√∫n documento real
- [ ] Corregir √≠tems por etapa

### ‚úÖ 2. UnidadController.php
- [ ] Cambiar validaci√≥n de tipos de archivo para Etapa 0
- [ ] Permitir solo `estudios_previos` en Etapa 0
- [ ] Actualizar l√≥gica de env√≠o

### ‚úÖ 3. unidad.blade.php
- [ ] Dropdown con solo "Estudios Previos" en Etapa 0
- [ ] Mostrar tipos correctos seg√∫n etapa actual

### ‚úÖ 4. WorkflowController.php
- [ ] No marcar `enviado=true` hasta confirmar env√≠o
- [ ] Permitir edici√≥n mientras `enviado=false`

